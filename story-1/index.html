<script>
    // ===== PHYSICAL BOOK CONFIGURATION =====
    const TOTAL_IMAGES = 20; // Cover + 18 pages + Back cover
    let currentState = 0; // 0 = cover alone, 1-9 = spreads, 10 = back cover alone
    let audioEnabled = true;
    
    // ===== DOM ELEMENTS =====
    const book = document.getElementById('book');
    const loader = document.getElementById('loader');
    const pageTurnSound = document.getElementById('pageTurnSound');
    
    // ===== INITIAL SETUP =====
    
    // Create background bubbles (same as before)
    function createBubbles() {
        // ... (same bubble code as before)
    }
    
    // Load all pages
    function loadPages() {
        let loadedCount = 0;
        
        // Create all 20 page divs
        for (let i = 1; i <= TOTAL_IMAGES; i++) {
            const pageNumber = i.toString().padStart(2, '0');
            const page = document.createElement('div');
            page.className = 'page';
            page.id = `page-${i}`;
            
            // Set initial position
            if (i === 1) {
                // Cover: start on right
                page.style.left = '50%';
            } else if (i === TOTAL_IMAGES) {
                // Back cover: start on left (but hidden)
                page.style.left = '0%';
                page.style.transform = 'rotateY(180deg)';
            } else {
                // Regular pages: alternate left/right
                page.style.left = i % 2 === 0 ? '0%' : '50%';
            }
            
            page.style.zIndex = TOTAL_IMAGES - i + 1;
            
            // Add image
            const img = document.createElement('img');
            img.src = `pages/${pageNumber}.jpg`;
            img.alt = `Page ${i}`;
            img.loading = i <= 3 ? 'eager' : 'lazy';
            
            img.onload = function() {
                loadedCount++;
                if (loadedCount === TOTAL_IMAGES) {
                    setTimeout(() => {
                        loader.style.display = 'none';
                        showInstructions();
                    }, 500);
                }
            };
            
            page.appendChild(img);
            book.appendChild(page);
        }
        
        updateDisplay();
    }
    
    // ===== PAGE NAVIGATION - PHYSICAL BOOK LOGIC =====
    
    function updateDisplay() {
        // Reset all pages
        document.querySelectorAll('.page').forEach(page => {
            page.style.transform = 'rotateY(0deg)';
        });
        
        // Update page counter
        let displayText = '';
        if (currentState === 0) {
            displayText = 'Cover';
        } else if (currentState === 10) {
            displayText = 'Back Cover';
        } else {
            const leftPage = currentState * 2;
            const rightPage = leftPage + 1;
            displayText = `Pages ${leftPage}-${rightPage}`;
        }
        document.getElementById('pageCounter').textContent = displayText;
        
        // Update button states
        document.getElementById('prevBtn').disabled = currentState <= 0;
        document.getElementById('nextBtn').disabled = currentState >= 10;
        
        // Show current state
        if (currentState === 0) {
            // Cover alone on right
            const cover = document.getElementById('page-1');
            if (cover) {
                cover.style.transform = 'rotateY(0deg)';
                cover.style.left = '50%';
            }
        } else if (currentState === 10) {
            // Back cover alone on left
            const backCover = document.getElementById(`page-${TOTAL_IMAGES}`);
            if (backCover) {
                backCover.style.transform = 'rotateY(0deg)';
                backCover.style.left = '0%';
            }
        } else {
            // Show spread: two pages
            const leftPageNum = currentState * 2;
            const rightPageNum = leftPageNum + 1;
            
            const leftPage = document.getElementById(`page-${leftPageNum}`);
            const rightPage = document.getElementById(`page-${rightPageNum}`);
            
            if (leftPage) {
                leftPage.style.transform = 'rotateY(0deg)';
                leftPage.style.left = '0%';
            }
            if (rightPage) {
                rightPage.style.transform = 'rotateY(0deg)';
                rightPage.style.left = '50%';
            }
        }
    }
    
    function nextPage() {
        if (currentState < 10) {
            playPageTurnSound();
            
            // Animate current page turning
            if (currentState === 0) {
                // Cover turns to reveal first spread
                const cover = document.getElementById('page-1');
                if (cover) {
                    cover.style.transition = 'transform 0.8s cubic-bezier(0.42, 0, 0.58, 1)';
                    cover.style.transform = 'rotateY(-180deg)';
                }
            } else if (currentState < 9) {
                // Left page of current spread turns
                const leftPageNum = currentState * 2;
                const leftPage = document.getElementById(`page-${leftPageNum}`);
                if (leftPage) {
                    leftPage.style.transition = 'transform 0.8s cubic-bezier(0.42, 0, 0.58, 1)';
                    leftPage.style.transform = 'rotateY(-180deg)';
                }
            } else if (currentState === 9) {
                // Last spread turns to reveal back cover
                const leftPageNum = currentState * 2; // page 18
                const leftPage = document.getElementById(`page-${leftPageNum}`);
                if (leftPage) {
                    leftPage.style.transition = 'transform 0.8s cubic-bezier(0.42, 0, 0.58, 1)';
                    leftPage.style.transform = 'rotateY(-180deg)';
                }
            }
            
            // Move to next state after animation
            setTimeout(() => {
                currentState++;
                updateDisplay();
            }, 800);
            
            return true;
        }
        return false;
    }
    
    function prevPage() {
        if (currentState > 0) {
            playPageTurnSound();
            
            // Animate going back
            if (currentState === 10) {
                // Back cover turns to reveal last spread
                const backCover = document.getElementById(`page-${TOTAL_IMAGES}`);
                if (backCover) {
                    backCover.style.transition = 'transform 0.8s cubic-bezier(0.42, 0, 0.58, 1)';
                    backCover.style.transform = 'rotateY(180deg)';
                }
            } else if (currentState > 1) {
                // Show page turning back
                const leftPageNum = (currentState - 1) * 2;
                const leftPage = document.getElementById(`page-${leftPageNum}`);
                if (leftPage) {
                    leftPage.style.transition = 'transform 0.8s cubic-bezier(0.42, 0, 0.58, 1)';
                    leftPage.style.transform = 'rotateY(0deg)';
                }
            } else if (currentState === 1) {
                // First spread turns back to cover
                const leftPageNum = 2; // page 2
                const leftPage = document.getElementById(`page-${leftPageNum}`);
                if (leftPage) {
                    leftPage.style.transition = 'transform 0.8s cubic-bezier(0.42, 0, 0.58, 1)';
                    leftPage.style.transform = 'rotateY(0deg)';
                }
            }
            
            // Move to previous state after animation
            setTimeout(() => {
                currentState--;
                updateDisplay();
            }, 800);
            
            return true;
        }
        return false;
    }
    
    // ===== AUDIO FUNCTIONS =====
    function playPageTurnSound() {
        if (!audioEnabled) return;
        try {
            pageTurnSound.currentTime = 0;
            pageTurnSound.play().catch(e => console.log("Audio play failed"));
        } catch (e) {
            console.log("Audio error:", e);
        }
    }
    
    // ===== REST OF CODE (same as before) =====
    // (Keep the instructions, fullscreen, event listeners, etc. from previous code)
    // ... [rest of the code remains the same]
</script>
